<html>
<title>CS81 Results Tool</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Roboto'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
    html,
    body,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        font-family: "Roboto", sans-serif
    }

    /* This can be removed? */
    .grid-container {
        display: grid;
    }
</style>

<body>
    <h1>{{"Same-ID" if same_id else "Different-ID"}} Comparison Confusing Faces ({{avg_or_median.capitalize()}})</h1>
    <form>
        <input hidden id="num_faces" value={{num_faces}}></input>
        {% for (idx, (avg_confidence, name, face_id, image_url, bbox, count)) in conf_id_url_bbox %}
        <input hidden id="text{{idx}}" value="{{name}} #{{face_id}} had {{avg_or_median}} {{avg_confidence}} over {{count}} trials."></input>
        <input hidden id="url{{idx}}" value={{image_url}}></input>
        <input hidden id="bbox_l{{idx}}" value="{{bbox[0]}}"></input>
        <input hidden id="bbox_t{{idx}}" value="{{bbox[1]}}"></input>
        <input hidden id="bbox_w{{idx}}" value="{{bbox[2]}}"></input>
        <input hidden id="bbox_h{{idx}}" value="{{bbox[3]}}"></input>
        <canvas id="canvas{{idx}}"></canvas>
        {% endfor %}
    </form>

</body>

<script>
    num_faces = document.getElementById('num_faces').value;
    for (i = 0; i < num_faces; i++) {
        bbox_l = document.getElementById('bbox_l' + i).value;
        bbox_t = document.getElementById('bbox_t' + i).value;
        bbox_w = document.getElementById('bbox_w' + i).value;
        bbox_h = document.getElementById('bbox_h' + i).value;
        bbox = [bbox_l, bbox_t, bbox_w, bbox_h]
        url = document.getElementById('url' + i).value;
        text = document.getElementById('text' + i).value;
        load_canvas(i, bbox, url, text);
    }

    function load_canvas(i, bbox, url, text) {

        // https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage
        const canvas = document.getElementById('canvas' + i);
        const ctx = canvas.getContext('2d');

        const image = new Image(500, 350); // Using optional size for image
        image.onload = drawImageActualSize; // Draw when image has loaded

        // Load an image of intrinsic size 1087x782 in CSS pixels
        image.src = url;

        function drawImageActualSize() {
            canvas.width = this.width;
            canvas.height = this.height + 50;

            ctx.drawImage(this, 0, 0, this.width, this.height)

            bbox_left = bbox[0];
            bbox_top = bbox[1];
            bbox_width = bbox[2];
            bbox_height = bbox[3];

            bbox_left /= this.naturalWidth;
            bbox_top /= this.naturalHeight;
            bbox_width /= this.naturalWidth;
            bbox_height /= this.naturalHeight;

            bbox_left *= this.width;
            bbox_top *= this.height;
            bbox_width *= this.width;
            bbox_height *= this.height;

            // https://www.w3schools.com/tags/canvas_rect.asp
            // context.rect(x,y,width,height);
            // x,y are for upper left corner
            ctx.beginPath();
            ctx.lineWidth = "6";
            ctx.strokeStyle = "red";
            ctx.rect(bbox_left, bbox_top, bbox_width, bbox_height);
            ctx.stroke();

            ctx.font = "20px Arial";
            ctx.fillText(text, 10, this.height + 25);
        }
    }
</script>

</html>